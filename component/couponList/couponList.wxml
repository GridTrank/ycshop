<wxs module="f">
	var sub = function(str, start, end) {
		return str.toString().substring(start, end);
	}
	var replace = function(str) {
		return str.replace('/↵/g', '\n');
	}
	module.exports = {
		substring: sub,
		replace: replace
	}
</wxs>
<view class="ms-coupon-list {{pageName}}">
	<view class='ms-coupon-item {{type.class}}' wx:for="{{couponList}}" wx:key="i">
		<view class="coupon-info ">
			<view class="coupon-price {{couponType[item.coupon_type].class || 'blue'}}" bindtap='selectCoupon' data-index="{{index}}">
				<image src="https://s1.miniso.cn/bsimg/ec/public/images/1e/61/1e61d7632198a14b47ba2421e71be422.png" class="coupon-line" wx:if="{{type.class == 'gray'}}"></image>
				
				<image  src="https://s1.miniso.cn/bsimg/ec/public/images/c0/d3/c0d3464983dff42bfdc03ffa94818809.png" class="coupon-line" wx:elif="{{couponType[item.coupon_type].class == 'yellow'}}"></image>
				<image  src="https://s1.miniso.cn/bsimg/ec/public/images/d0/63/d0630df1e7abbb201bf7408c6e1f0e6b.png" class="coupon-line" wx:elif="{{couponType[item.coupon_type].class == 'red'}}"></image>
				<image  src="https://s1.miniso.cn/bsimg/ec/public/images/e3/dc/e3dcf5f91b63c4fc4f85d9c27a07f3c7.png" class="coupon-line" wx:else></image>
				<view class="price" wx:if="{{item.discount_amount}}">
					<!-- 文字（免邮） -->
					<block wx:if="{{item.s_template == 'b2c_promotion_solutions_freeshipping' || item.s_template == 'gift_promotion_solutions_gift'}}">
						<text class='discounts'>{{item.discount_amount}}</text>
					</block>
					<!-- 打折 -->
					<block wx:elif="{{item.s_template == 'b2c_promotion_solutions_bypercent' || item.s_template == 'b2c_promotion_solutions_topercent'}}">
						<text class='discounts'>{{item.discount_amount}}</text>
						<text class='min'>折</text>
					</block>
					<!-- 价格 -->
					<block wx:elif="{{item.s_template == 'b2c_promotion_solutions_byfixed' || item.s_template == 'b2c_promotion_solutions_tofixed' || item.s_template == 'b2c_promotion_solutions_bysysfixed'}}">
						<text class='min'>¥</text>
						<text class='discounts'>{{item.discount_amount}}</text>
					</block>
					<block wx:else>
						<text class='discounts'>{{item.discount_amount}}</text>
					</block>
				</view>
				<view class="type">{{couponType[item.coupon_type].name || ''}}</view>
			</view>
			<view class="coupon-name">
				<view bindtap='selectCoupon' data-index="{{index}}">
					<view class="tag">
						<text class="item">{{item.use_range_type_text}}</text>
					</view>
					<view class="name">{{item.cpns_name}}</view>
					<view class="date">{{item.from_time}}-{{item.to_time}}</view>
				</view>
				<view class="rule-warp">
					<view class="rule " bindtap="descUp" data-id="{{item.cpns_id}}" data-code="{{item.memc_code}}">
						使用规则 <image class="arrow {{isdescUp == (item.cpns_id+item.memc_code) ? 'open' :''}}" src="https://s1.miniso.cn/bsimg/ec/public/images/7d/15/7d15663dad6e9c954bd8c111e41ce6bc.png" mode="widthFix"></image>
					</view>
					<view class="button-warp">
						 <navigator hover-class="none"url="{{item.use_range_type == 1 ? '/pages/index/index':'/pages/cumulativeOrder/index?type=coupon&id='+item.rule_id}}" wx:if="{{(pageName == 'list' && type.status == 1) || (pageName == 'detail' && couponState[item.cpns_id].is_receive)}}" open-type='{{item.use_range_type == 1 ?"switchTab":"navigate"}}' class="btn">{{pageName == 'detail'? '立即使用':'去使用'}}</navigator>
						<view class="btn" bindtap="getCoupon" wx:if="{{pageName == 'detail' && !couponState[item.cpns_id].is_receive}}" data-index="{{index}}">点击领取</view>

						
					</view>
				</view>

				<!-- 已选择 -->
				<image class="state get" mode="widthFix" src='https://s1.miniso.cn/bsimg/ec/public/images/dc/69/dc69b865cf901059a4900f0ef5fd8023.png' wx:if="{{item.use_status == 'using'}}"></image>
				<!-- 已失效 -->
				<image class="state" mode="widthFix" src='https://s1.miniso.cn/bsimg/ec/public/images/f7/e0/f7e053e205f8f970236db589135cf37d.png' wx:if="{{type.status == 3}}"></image>
				<!-- 已使用 -->
				<image class="state" mode="widthFix" src='https://s1.miniso.cn/bsimg/ec/public/images/04/62/0462a519e5bb79ff6ed1d31ee6803d1a.png' wx:if="{{type.status == 2}}"></image>
				<!-- 已领取 -->
				<image class="state " mode="widthFix" src='https://s1.miniso.cn/bsimg/ec/public/images/8f/59/8f59523f22dc7824f3c18bb1f1dbe682.png' wx:if="{{couponState[item.cpns_id].is_receive}}"></image>

			</view>
		</view>
		<view class="coupon-rule {{isdescUp == (item.cpns_id+item.memc_code) ? 'open' :''}}">
			<text class="p">{{f.replace(item.description)}}</text>
		</view>
	</view>

</view>